{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    {% include "base/css.html" %}

    <title>eCommerce</title>
    <title>- {{title}}</title>

  </head>
  <body>
    {% include "base/nav_bar.html" %}
    <!--block content-->
    <div class="container">{% block content %}{% endblock %}</div>

    {% include "base/js.html" %}
    <script>
      $(document).ready(function() {
        // blocks normal submission of form and creates an ajax request
          let productForm = $('.ajax-product-form')
          productForm.submit(function(event) {
              event.preventDefault();
              let action = productForm.attr('action')
              let httpmethod = productForm.attr('method')
              let formData = productForm.serialize()
              console.log(action, httpmethod, formData)
              $.ajax({
                  url: action,
                  method: httpmethod,
                  data: formData,
                  success: function(data){
                    console.log('success', data)
                     // if view successfully handles form then want to update original html to change between added to cart and remove
                    let addbutton = productForm.find('.alternate-add-button')
                    if (data.added) {
                      addbutton.html('Item in cart <button type="submit" class="btn btn-link">Remove?</button>')
                    } else {
                      addbutton.html('<button type="submit" class="btn btn-primary">Add to cart?</button>')
                    }
                    let navbarCartCount = $('.navbar-cart-count')
                    if (data.cartCount > 0) {
                      navbarCartCount.html(data.cartCount)
                    } else {
                      navbarCartCount.html('')
                    }
                    
                   
                  },
                  error: function(errorData){
                    console.log('error', errorData)
                  }


              })

          })
      })
    </script>
  </body>
</html>